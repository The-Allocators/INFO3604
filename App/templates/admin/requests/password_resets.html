{% extends "admin/base.html" %}

{% block title %}Password Reset Requests - Help Desk System{% endblock %}

{% block extra_css %}
<style>
/* Password Reset Requests specific styles */
.tabs {
  display: flex;
  border-bottom: 1px solid #e6e9ef;
  margin-bottom: 1.75rem;
}

h4 {
  font-size: 1.75rem;
  font-weight: 600;
  color: #0f2a52;
  margin-bottom: 1.5rem;
}

.tab {
  padding: 0.85rem 1.5rem;
  cursor: pointer;
  position: relative;
  font-weight: 500;
  color: #64748b;
  transition: all 0.3s ease;
}

.tab:hover {
  color: #0066cc;
}

.tab.active {
  color: #0066cc;
  border-bottom: 2px solid #0066cc;
}

/* Search container styling */
.search-container {
  position: relative;
  margin-bottom: 1.75rem;
}

.search-container i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #94a3b8;
  font-size: 1.25rem;
}

.search-input {
  width: 100%;
  padding: 0.9rem 1rem 0.9rem 2.75rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 1rem;
  background-color: #fff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.search-input:focus {
  outline: none;
  border-color: #0066cc;
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
}

/* Section headers */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.25rem;
  margin-top: 2rem;
}

.section-header h5 {
  font-size: 1.2rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0;
  position: relative;
  padding-left: 0.75rem;
}

.section-header h5::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.25rem;
  bottom: 0.25rem;
  width: 3px;
  background-color: #0066cc;
  border-radius: 3px;
}

/* Reset Request Card Styling */
.reset-card {
  background-color: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
  border: 1px solid #e6e9ef;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

.reset-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.08);
}

.reset-card.pending {
  border-left: 4px solid #f59e0b;
}

.reset-card.completed {
  border-left: 4px solid #10b981;
}

.reset-card.rejected {
  border-left: 4px solid #ef4444;
}

.reset-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.25rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #f1f5f9;
}

.reset-name {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 0.25rem;
}

.reset-id {
  color: #64748b;
  font-size: 0.9rem;
}

.reset-status {
  font-weight: 600;
  padding: 0.35rem 0.85rem;
  border-radius: 20px;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.reset-card.pending .reset-status {
  background-color: #fef3c7;
  color: #d97706;
}

.reset-card.completed .reset-status {
  background-color: #d1fae5;
  color: #059669;
}

.reset-card.rejected .reset-status {
  background-color: #fee2e2;
  color: #dc2626;
}

.reset-detail-row {
  display: flex;
  margin-bottom: 0.85rem;
}

.reset-label {
  width: 130px;
  font-weight: 500;
  color: #64748b;
  flex-shrink: 0;
}

.reset-value {
  flex: 1;
  color: #1e293b;
}

.reset-reason {
  padding: 0.85rem 1rem;
  background-color: #f8fafc;
  border-radius: 8px;
  font-size: 0.95rem;
  color: #334155;
  line-height: 1.5;
  border: 1px solid #e2e8f0;
  margin-top: 0.25rem;
}

.reset-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid #f1f5f9;
}

.btn-reject {
  padding: 0.6rem 1.25rem;
  background-color: white;
  color: #dc2626;
  border: 1px solid #dc2626;
  border-radius: 6px;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.btn-reject:hover {
  background-color: #fee2e2;
  transform: translateY(-1px);
}

.btn-complete {
  padding: 0.6rem 1.25rem;
  background-color: #10b981;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.btn-complete:hover {
  background-color: #059669;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
}

.no-resets {
  text-align: center;
  padding: 2.5rem;
  background-color: white;
  border-radius: 12px;
  color: #64748b;
  font-size: 1.05rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  border: 1px dashed #cbd5e1;
  margin-bottom: 1rem;
}

/* Modal Styles */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(15, 23, 42, 0.5);
  z-index: 1000;
  backdrop-filter: blur(3px);
  animation: fadeIn 0.3s ease;
}

.modal {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  border-radius: 12px;
  padding: 1.75rem;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-size: 1.5rem;
  font-weight: bold;
  color: #64748b;
  cursor: pointer;
  transition: color 0.2s;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.modal-close:hover {
  color: #1e293b;
  background-color: #f1f5f9;
}

.modal-header {
  margin-bottom: 1.5rem;
}

.modal-title {
  font-size: 1.35rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0;
}

.form-group {
  margin-bottom: 1.25rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #334155;
}

.form-group input, .form-group textarea {
  width: 100%;
  padding: 0.85rem 1rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-group input:focus, .form-group textarea:focus {
  outline: none;
  border-color: #0066cc;
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1.5rem;
}

/* Loading overlay */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(3px);
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f3f3;
  border-top: 5px solid #0066cc;
  border-radius: 50%;
  animation: spin 1.5s linear infinite;
  box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Flash message styling */
.flash-message {
  position: fixed;
  top: 1.5rem;
  right: 1.5rem;
  z-index: 100;
  padding: 1rem 1.5rem;
  border-radius: 8px;
  color: white;
  animation: fadeOut 5s forwards;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.flash-message.success {
  background-color: #10b981;
}

.flash-message.error {
  background-color: #ef4444;
}

@keyframes fadeOut {
  0% { opacity: 1; }
  70% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-10px); display: none; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .reset-detail-row {
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
  }
  
  .reset-label {
    width: 100%;
    margin-bottom: 0.25rem;
  }
  
  .reset-actions {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .btn-reject, .btn-complete {
    width: 100%;
    text-align: center;
  }
  
  .search-input {
    padding: 0.75rem 1rem 0.75rem 2.75rem;
  }

  
}
</style>
{% endblock %}

{% block content %}
<h4>Password Reset Management</h4>


<div class="tabs">
  <div class="tab" onclick="window.location.href='{{ url_for('requests_views.requests') }}'">Shift Requests</div>
  <div class="tab" onclick="window.location.href='{{ url_for('requests_views.registrations') }}'">Registration Requests</div>
  <div class="tab active">Password Reset Requests</div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="search-container">
    <i class="material-icons">search</i>
    <input type="text" id="resetSearchInput" placeholder="Search by name or ID" class="search-input">
</div>

<!-- Pending Reset Requests -->
<div class="section-header">
    <h5>Pending Password Reset Requests</h5>
</div>

<div id="pendingResets" class="resets-section">
    {% if pending_requests %}
        {% for request in pending_requests %}
            <div class="reset-card pending" data-name="{{ request.name }}" data-id="{{ request.username }}">
                <div class="reset-top">
                    <div>
                        <div class="reset-name">{{ request.name }}</div>
                        <div class="reset-id">ID: {{ request.username }}</div>
                    </div>
                    <div class="reset-status">PENDING</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Request Date:</div>
                    <div class="reset-value">{{ request.created_at|datetime }}</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Reason:</div>
                    <div class="reset-value">
                        <div class="reset-reason">{{ request.reason }}</div>
                    </div>
                </div>
                
                <div class="reset-actions">
                    <button class="btn-reject" onclick="openRejectModal({{ request.id }})">Reject</button>
                    <button class="btn-complete" onclick="openCompleteModal({{ request.id }}, '{{ request.username }}')">Set New Password</button>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="no-resets">
            <p>No pending password reset requests.</p>
        </div>
    {% endif %}
</div>

<!-- Completed Reset Requests -->
<div class="section-header">
    <h5>Completed Password Reset Requests</h5>
</div>

<div id="completedResets" class="resets-section">
    {% if completed_requests %}
        {% for request in completed_requests %}
            <div class="reset-card {% if request.status == 'COMPLETED' %}completed{% else %}rejected{% endif %}" data-name="{{ request.name }}" data-id="{{ request.username }}">
                <div class="reset-top">
                    <div>
                        <div class="reset-name">{{ request.name }}</div>
                        <div class="reset-id">ID: {{ request.username }}</div>
                    </div>
                    <div class="reset-status">{{ request.status }}</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Request Date:</div>
                    <div class="reset-value">{{ request.created_at|datetime }}</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Processed Date:</div>
                    <div class="reset-value">{{ request.processed_at|datetime }}</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Processed By:</div>
                    <div class="reset-value">{{ request.processed_by }}</div>
                </div>
                
                <div class="reset-detail-row">
                    <div class="reset-label">Reason:</div>
                    <div class="reset-value">
                        <div class="reset-reason">{{ request.reason }}</div>
                    </div>
                </div>
                
                {% if request.status == 'REJECTED' and request.rejection_reason %}
                <div class="reset-detail-row">
                    <div class="reset-label">Rejection Reason:</div>
                    <div class="reset-value">
                        <div class="reset-reason">{{ request.rejection_reason }}</div>
                    </div>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class="no-resets">
            <p>No completed password reset requests.</p>
        </div>
    {% endif %}
</div>

<!-- Modal for Completing Password Reset -->
<div id="completeModal" class="modal-overlay">
    <div class="modal">
        <span class="modal-close" onclick="closeModals()">&times;</span>
        <div class="modal-header">
            <h3 class="modal-title">Set New Password</h3>
        </div>
        <div class="modal-content">
            <form id="completeForm">
                <input type="hidden" id="resetId" name="resetId">
                <div class="form-group">
                    <label for="username">User ID:</label>
                    <input type="text" id="username" name="username" readonly>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password:</label>
                    <input type="password" id="newPassword" name="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password:</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-reject" onclick="closeModals()">Cancel</button>
                    <button type="button" class="btn-complete" onclick="completePasswordReset()">Set Password</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for Rejecting Password Reset -->
<div id="rejectModal" class="modal-overlay">
    <div class="modal">
        <span class="modal-close" onclick="closeModals()">&times;</span>
        <div class="modal-header">
            <h3 class="modal-title">Reject Password Reset Request</h3>
        </div>
        <div class="modal-content">
            <form id="rejectForm">
                <input type="hidden" id="rejectResetId" name="rejectResetId">
                <div class="form-group">
                    <label for="rejectionReason">Rejection Reason (Optional):</label>
                    <textarea id="rejectionReason" name="rejectionReason" rows="4" placeholder="Provide a reason for rejecting this request"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-reject" onclick="closeModals()">Cancel</button>
                    <button type="button" class="btn-complete" onclick="rejectPasswordReset()">Reject Request</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Loading overlay (hidden by default) -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Password Reset Requests JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Initialize search functionality
    initializeSearch();
    
    // Add animation to reset cards
    animateResetCards();
    
    // Hide flash messages after 5 seconds
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(message => {
        setTimeout(() => {
            message.style.opacity = '0';
            message.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 500);
        }, 5000);
    });
});

/**
* Initialize search functionality for reset request cards
*/
function initializeSearch() {
    const searchInput = document.getElementById('resetSearchInput');
    if (!searchInput) return;
    
    // Add transition styles to reset cards for smoother filtering
    const resetCards = document.querySelectorAll('.reset-card');
    resetCards.forEach(card => {
        card.style.transition = 'all 0.3s ease, opacity 0.3s ease, transform 0.3s ease';
    });
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        let foundResults = {
            pendingResets: 0,
            completedResets: 0
        };
        
        // Search in all reset cards
        resetCards.forEach(card => {
            const name = card.getAttribute('data-name').toLowerCase();
            const id = card.getAttribute('data-id').toLowerCase();
            const parent = card.parentNode.id;
            
            if (name.includes(searchTerm) || id.includes(searchTerm)) {
                card.style.display = 'block';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
                
                // Increment counter for this section
                if (parent === 'pendingResets') {
                    foundResults.pendingResets++;
                } else if (parent === 'completedResets') {
                    foundResults.completedResets++;
                }
                
                // Optional: Highlight the matching text
                if (searchTerm.length > 1) {
                    highlightMatch(card.querySelector('.reset-name'), name, searchTerm);
                    highlightMatch(card.querySelector('.reset-id'), id, searchTerm);
                }
            } else {
                card.style.opacity = '0';
                card.style.transform = 'translateY(10px)';
                
                // Hide after transition completes
                setTimeout(() => {
                    if (!name.includes(searchTerm) && !id.includes(searchTerm)) {
                        card.style.display = 'none';
                    }
                }, 300);
            }
        });
        
        // Check if each section is now empty after filtering
        checkEmptySections(foundResults, searchTerm);
    });
}

/**
* Highlight matching text in search results
*/
function highlightMatch(element, text, searchTerm) {
    // Skip if element doesn't exist
    if (!element) return;
    
    // Get original text content
    const originalText = element.textContent;
    
    // Find the match location (case insensitive)
    const lowerText = originalText.toLowerCase();
    const matchIndex = lowerText.indexOf(searchTerm.toLowerCase());
    
    if (matchIndex >= 0) {
        // Extract parts of the text
        const prefix = originalText.substring(0, matchIndex);
        const match = originalText.substring(matchIndex, matchIndex + searchTerm.length);
        const suffix = originalText.substring(matchIndex + searchTerm.length);
        
        // Create highlighted text with span
        element.innerHTML = prefix + 
            `<span style="background-color: rgba(255, 243, 160, 0.5); padding: 0 2px; border-radius: 2px; font-weight: 600;">${match}</span>` + 
            suffix;
    }
}

/**
* Check if sections are empty after filtering and show appropriate messages
*/
function checkEmptySections(foundResults, searchTerm) {
    // Messages for each section
    const sections = [
        { 
            containerId: 'pendingResets', 
            message: 'No pending password reset requests matching your search.',
            count: foundResults.pendingResets
        },
        { 
            containerId: 'completedResets', 
            message: 'No completed password reset requests matching your search.',
            count: foundResults.completedResets
        }
    ];
    
    sections.forEach(section => {
        const container = document.getElementById(section.containerId);
        if (!container) return;
        
        // Remove existing "no results" message
        const existingNoResults = container.querySelector('.no-resets.search-results');
        if (existingNoResults) {
            existingNoResults.remove();
        }
        
        // Only add "no results" message if there are cards but none are visible due to search
        const totalCards = container.querySelectorAll('.reset-card').length;
        
        if (searchTerm && totalCards > 0 && section.count === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-resets search-results';
            noResults.innerHTML = `<p>${section.message}</p>`;
            container.appendChild(noResults);
            
            // Add fade-in animation
            noResults.style.animation = 'fadeIn 0.3s ease';
        }
    });
}

/**
* Add entrance animations to reset cards
*/
function animateResetCards() {
    const resetCards = document.querySelectorAll('.reset-card');
    
    resetCards.forEach((card, index) => {
        // Set initial state
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        // Create staggered animation
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, 50 * index);
    });
}

/**
* Open the complete reset modal
*/
function openCompleteModal(resetId, username) {
    const modal = document.getElementById('completeModal');
    const resetIdInput = document.getElementById('resetId');
    const usernameInput = document.getElementById('username');
    
    resetIdInput.value = resetId;
    usernameInput.value = username;
    
    modal.style.display = 'block';
}

/**
* Open the reject reset modal
*/
function openRejectModal(resetId) {
    const modal = document.getElementById('rejectModal');
    const resetIdInput = document.getElementById('rejectResetId');
    
    resetIdInput.value = resetId;
    
    modal.style.display = 'block';
}

/**
* Close all modals
*/
function closeModals() {
    document.getElementById('completeModal').style.display = 'none';
    document.getElementById('rejectModal').style.display = 'none';
    
    // Clear form inputs
    document.getElementById('newPassword').value = '';
    document.getElementById('confirmPassword').value = '';
    document.getElementById('rejectionReason').value = '';
}

/**
* Complete a password reset
*/
function completePasswordReset() {
    const resetId = document.getElementById('resetId').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // Validate inputs
    if (newPassword === '') {
        showNotification('Please enter a new password', 'error');
        return;
    }
    
    if (newPassword !== confirmPassword) {
        showNotification('Passwords do not match', 'error');
        return;
    }
    
    // Show confirmation dialog
    if (!confirm('Are you sure you want to reset this password?')) {
        return;
    }
    
    // Show loading overlay
    showLoading();
    
    // Make API call to complete the password reset
    fetch(`/api/password-resets/${resetId}/complete`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            new_password: newPassword
        })
    })
    .then(response => response.json())
    .then(data => {
        // Hide loading overlay
        hideLoading();
        
        if (data.success) {
            // Show success message
            showNotification('Password has been reset successfully', 'success');
            
            // Close the modal
            closeModals();
            
            // Reload the page after a short delay
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showNotification(`Error: ${data.message}`, 'error');
        }
    })
    .catch(error => {
        // Hide loading overlay
        hideLoading();
        
        console.error('Error:', error);
        showNotification('An error occurred while processing the request', 'error');
    });
}

/**
* Reject a password reset
*/
function rejectPasswordReset() {
    const resetId = document.getElementById('rejectResetId').value;
    const rejectionReason = document.getElementById('rejectionReason').value;
    
    // Show confirmation dialog
    if (!confirm('Are you sure you want to reject this password reset request?')) {
        return;
    }
    
    // Show loading overlay
    showLoading();
    
    // Make API call to reject the password reset
    fetch(`/api/password-resets/${resetId}/reject`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            reason: rejectionReason
        })
    })
    .then(response => response.json())
    .then(data => {
        // Hide loading overlay
        hideLoading();
        
        if (data.success) {
            // Show success message
            showNotification('Password reset request has been rejected', 'success');
            
            // Close the modal
            closeModals();
            
            // Reload the page after a short delay
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showNotification(`Error: ${data.message}`, 'error');
        }
    })
    .catch(error => {
        // Hide loading overlay
        hideLoading();
        
        console.error('Error:', error);
        showNotification('An error occurred while processing the request', 'error');
    });
}

/**
* Show loading overlay
*/
function showLoading() {
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = 'flex';
    }
}

/**
* Hide loading overlay
*/
function hideLoading() {
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
        // Add slight delay to make loading feel more natural
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
        }, 300);
    }
}

/**
* Show notification message
*/
function showNotification(message, type = 'info') {
    // Remove any existing notifications first
    document.querySelectorAll('.flash-message').forEach(el => {
        if (el.parentNode) el.parentNode.removeChild(el);
    });
    
    // Create a notification element
    const notification = document.createElement('div');
    notification.className = `flash-message ${type}`;
    
    // Add icon based on notification type
    if (type === 'success') {
        notification.innerHTML = `<span style="margin-right: 8px;">✓</span>${message}`;
    } else if (type === 'error') {
        notification.innerHTML = `<span style="margin-right: 8px;">⚠️</span>${message}`;
    } else {
        notification.textContent = message;
    }
    
    // Add the notification to the page
    document.body.appendChild(notification);
    
    // Remove the notification after a delay
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 500);
    }, 5000);
}
</script>
{% endblock %}