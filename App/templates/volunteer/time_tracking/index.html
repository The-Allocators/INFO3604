{% extends "volunteer/base.html" %}

{% block title %}Time Tracking - Help Desk System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/volunteer/tracking.css') }}">
<style>
  /* Additional notification styling for messages */
  .notification-message {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    padding: 1rem 1.5rem;
    border-radius: 4px;
    font-weight: 500;
    color: white;
    z-index: 2000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: opacity 0.3s ease;
  }
  
  .notification-message.success {
    background-color: #10b981;
  }
  
  .notification-message.error {
    background-color: #ef4444;
  }
  
  .notification-message.fade-out {
    opacity: 0;
  }
</style>
{% endblock %}

{% block content %}
<div class="content">
  <!-- Today's Shift Section -->
  <div class="today-shift-section">
    <h2 class="section-title">Today's Shift</h2>
    <div class="shift-info-card">
      <div class="shift-details">
        <p><strong>Date:</strong> {{ today_shift.date }}</p>
        <p><strong>Time:</strong> {{ today_shift.time }}</p>
        {% if today_shift.status == 'future' %}
          <p><strong>Starting in:</strong> {{ today_shift.time_until }}</p>
        {% elif today_shift.status == 'active' %}
          <p><strong>Time remaining:</strong> {{ today_shift.time_until }}</p>
        {% endif %}
      </div>
      <div>
        {% if today_shift.status == 'active' and not today_shift.starts_now %}
          <button class="action-button clock-in" id="clockInBtn">Clock In</button>
        {% elif today_shift.status == 'active' and today_shift.starts_now %}
          <button class="action-button clock-out" id="clockOutBtn">Clock Out</button>
        {% elif today_shift.status == 'future' %}
          <button class="action-button clock-in" disabled>Clock In (Not Started)</button>
        {% else %}
          <button class="action-button clock-in" disabled>No Shift Today</button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="two-column-layout">
    <!-- Shift History Section -->
    <div class="shift-history-section">
      <h2 class="section-title">Recent Shifts</h2>
      <table class="shift-history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Hours</th>
          </tr>
        </thead>
        <tbody>
          {% if shift_history %}
            {% for shift in shift_history %}
              <tr>
                <td>{{ shift.date }}</td>
                <td>{{ shift.time_range }}</td>
                <td>{{ shift.hours }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="3" class="empty-state">No recent shifts</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Time Distribution Chart -->
    <div class="time-distribution">
      <h3>Weekly Hours by Day</h3>
      <div class="chart-container">
        <div class="chart-y-labels">
          <span>8h</span>
          <span>6h</span>
          <span>4h</span>
          <span>2h</span>
          <span>0h</span>
        </div>
        <div class="chart">
          {% if time_distribution and time_distribution|length > 0 %}
            {% for day in time_distribution %}
              <div class="chart-bar">
                <div class="bar-value" style="height: {{ day.percentage }}%;"></div>
                <div class="bar-label">{{ day.label }}<br>{{ day.hours|round(1) }}h</div>
              </div>
            {% endfor %}
          {% else %}
            <!-- Empty state for chart when no data is available -->
            {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'] %}
              <div class="chart-bar">
                <div class="bar-value" style="height: 0%;"></div>
                <div class="bar-label">{{ day }}<br>0h</div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Hours Worked Section -->
  <div class="hours-worked-section">
    <h2 class="section-title">Hours Summary</h2>
    <div class="hours-grid">
      <div class="hours-card">
        <h3>TODAY</h3>
        <div class="date-range">{{ daily.date_range }}</div>
        <p class="hours-value">{{ daily.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>THIS WEEK</h3>
        <div class="date-range">{{ weekly.date_range }}</div>
        <p class="hours-value">{{ weekly.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>THIS MONTH</h3>
        <div class="date-range">{{ monthly.date_range }}</div>
        <p class="hours-value">{{ monthly.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>SEMESTER TOTAL</h3>
        <div class="date-range">{{ semester.date_range }}</div>
        <p class="hours-value">{{ semester.hours }}</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/volunteer/tracking.js') }}"></script>
{% endblock %}