{% extends "volunteer/base.html" %}

{% block title %}Time Tracking - Help Desk System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/volunteer/tracking.css') }}">
<style>
  /* Additional notification styling for messages */
  .notification-message {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    padding: 1rem 1.5rem;
    border-radius: 4px;
    font-weight: 500;
    color: white;
    z-index: 2000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: opacity 0.3s ease;
  }
  
  .notification-message.success {
    background-color: #10b981;
  }
  
  .notification-message.error {
    background-color: #ef4444;
  }
  
  .notification-message.fade-out {
    opacity: 0;
  }
</style>
{% endblock %}

{% block content %}
<div class="content">
  <!-- Today's Shift Section -->
  <div class="today-shift-section">
    <h2 class="section-title">Today's Shift</h2>
    <div class="shift-info-card">
      <div class="shift-details">
        <p><strong>Date:</strong> {{ today_shift.date }}</p>
        <p><strong>Time:</strong> {{ today_shift.time }}</p>
        {% if today_shift.status == 'future' %}
          <p><strong>Starting in:</strong> {{ today_shift.time_until }}</p>
        {% elif today_shift.status == 'active' %}
          <p><strong>Time remaining:</strong> {{ today_shift.time_until }}</p>
        {% endif %}
      </div>
      <div>
        {% if today_shift.status == 'active' and not today_shift.starts_now %}
          <button class="action-button clock-in" id="clockInBtn">Clock In</button>
        {% elif today_shift.status == 'active' and today_shift.starts_now %}
          <button class="action-button clock-out" id="clockOutBtn">Clock Out</button>
        {% elif today_shift.status == 'future' %}
          <button class="action-button clock-in" disabled>Clock In (Not Started)</button>
        {% else %}
          <button class="action-button clock-in" disabled>No Shift Today</button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="two-column-layout">
    <!-- Shift History Section -->
    <div class="shift-history-section">
      <h2 class="section-title">Recent Shifts</h2>
      <table class="shift-history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Hours</th>
          </tr>
        </thead>
        <tbody>
          {% if shift_history %}
            {% for shift in shift_history %}
              <tr>
                <td>{{ shift.date }}</td>
                <td>{{ shift.time_range }}</td>
                <td>{{ shift.hours }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="3" class="empty-state">No recent shifts</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Time Distribution Chart - With Accurate Proportions -->
    <div style="background-color: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.08); height: 100%;">
      <!-- Title -->
      <div style="margin-bottom: 1.5rem; color: #0f2a52; font-weight: 600; font-size: 1rem; text-transform: uppercase;">
        Weekly Hours by Day
      </div>
      
      <!-- Chart layout using HTML table with accurate proportions -->
      <table style="width: 100%; border-collapse: collapse; table-layout: fixed; height: 250px;">
        <!-- Main chart container with grid lines -->
        <tr style="height: 200px; position: relative;">
          <!-- Y-axis labels with grid lines -->
          <td style="width: 30px; position: relative;">
            <div style="position: absolute; top: 0; right: 10px; bottom: 0; display: flex; flex-direction: column; justify-content: space-between; height: 100%;">
              <div style="font-size: 11px; color: #64748b; padding-bottom: 2px;">8h</div>
              <div style="font-size: 11px; color: #64748b; padding-bottom: 2px;">6h</div>
              <div style="font-size: 11px; color: #64748b; padding-bottom: 2px;">4h</div>
              <div style="font-size: 11px; color: #64748b; padding-bottom: 2px;">2h</div>
              <div style="font-size: 11px; color: #64748b;">0h</div>
            </div>
          </td>
          
          <!-- Grid and Chart Area -->
          <td colspan="5" style="position: relative; vertical-align: bottom; padding: 0;">
            <!-- Grid lines (horizontal) -->
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;">
              <div style="position: absolute; top: 0%; left: 0; right: 0; height: 1px; background-color: #f1f5f9;"></div>
              <div style="position: absolute; top: 25%; left: 0; right: 0; height: 1px; background-color: #f1f5f9;"></div>
              <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background-color: #f1f5f9;"></div>
              <div style="position: absolute; top: 75%; left: 0; right: 0; height: 1px; background-color: #f1f5f9;"></div>
              <div style="position: absolute; top: 100%; left: 0; right: 0; height: 1px; background-color: #e2e8f0;"></div>
            </div>
            
            <!-- Bars container -->
            <div style="display: flex; height: 100%; width: 100%;">
              <!-- Monday bar -->
              <div style="flex: 1; display: flex; justify-content: center; align-items: flex-end;">
                <div style="width: 65%; height: {{ (time_distribution[0].hours / 8) * 100 }}%; background: linear-gradient(to top, #0066cc, #2563eb); border-radius: 4px 4px 0 0; min-height: {{ 1 if time_distribution[0].hours > 0 else 0 }}px;"></div>
              </div>
              
              <!-- Tuesday bar -->
              <div style="flex: 1; display: flex; justify-content: center; align-items: flex-end;">
                <div style="width: 65%; height: {{ (time_distribution[1].hours / 8) * 100 }}%; background: linear-gradient(to top, #0066cc, #2563eb); border-radius: 4px 4px 0 0; min-height: {{ 1 if time_distribution[1].hours > 0 else 0 }}px;"></div>
              </div>
              
              <!-- Wednesday bar -->
              <div style="flex: 1; display: flex; justify-content: center; align-items: flex-end;">
                <div style="width: 65%; height: {{ (time_distribution[2].hours / 8) * 100 }}%; background: linear-gradient(to top, #0066cc, #2563eb); border-radius: 4px 4px 0 0; min-height: {{ 1 if time_distribution[2].hours > 0 else 0 }}px;"></div>
              </div>
              
              <!-- Thursday bar -->
              <div style="flex: 1; display: flex; justify-content: center; align-items: flex-end;">
                <div style="width: 65%; height: {{ (time_distribution[3].hours / 8) * 100 }}%; background: linear-gradient(to top, #0066cc, #2563eb); border-radius: 4px 4px 0 0; min-height: {{ 1 if time_distribution[3].hours > 0 else 0 }}px;"></div>
              </div>
              
              <!-- Friday bar -->
              <div style="flex: 1; display: flex; justify-content: center; align-items: flex-end;">
                <div style="width: 65%; height: {{ (time_distribution[4].hours / 8) * 100 }}%; background: linear-gradient(to top, #0066cc, #2563eb); border-radius: 4px 4px 0 0; min-height: {{ 1 if time_distribution[4].hours > 0 else 0 }}px;"></div>
              </div>
            </div>
          </td>
        </tr>
        
        <!-- Labels row -->
        <tr style="height: 40px;">
          <td></td>
          <td style="text-align: center; vertical-align: top; padding-top: 8px;">
            <div style="font-size: 12px; font-weight: 500; color: #334155;">Mon</div>
            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">{{ time_distribution[0].hours|round(1) }}h</div>
          </td>
          <td style="text-align: center; vertical-align: top; padding-top: 8px;">
            <div style="font-size: 12px; font-weight: 500; color: #334155;">Tue</div>
            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">{{ time_distribution[1].hours|round(1) }}h</div>
          </td>
          <td style="text-align: center; vertical-align: top; padding-top: 8px;">
            <div style="font-size: 12px; font-weight: 500; color: #334155;">Wed</div>
            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">{{ time_distribution[2].hours|round(1) }}h</div>
          </td>
          <td style="text-align: center; vertical-align: top; padding-top: 8px;">
            <div style="font-size: 12px; font-weight: 500; color: #334155;">Thu</div>
            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">{{ time_distribution[3].hours|round(1) }}h</div>
          </td>
          <td style="text-align: center; vertical-align: top; padding-top: 8px;">
            <div style="font-size: 12px; font-weight: 500; color: #334155;">Fri</div>
            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">{{ time_distribution[4].hours|round(1) }}h</div>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <!-- Hours Worked Section -->
  <div class="hours-worked-section">
    <h2 class="section-title">Hours Summary</h2>
    <div class="hours-grid">
      <div class="hours-card">
        <h3>TODAY</h3>
        <div class="date-range">{{ daily.date_range }}</div>
        <p class="hours-value">{{ daily.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>THIS WEEK</h3>
        <div class="date-range">{{ weekly.date_range }}</div>
        <p class="hours-value">{{ weekly.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>THIS MONTH</h3>
        <div class="date-range">{{ monthly.date_range }}</div>
        <p class="hours-value">{{ monthly.hours }}</p>
      </div>
      <div class="hours-card">
        <h3>SEMESTER TOTAL</h3>
        <div class="date-range">{{ semester.date_range }}</div>
        <p class="hours-value">{{ semester.hours }}</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/volunteer/tracking.js') }}"></script>
{% endblock %}